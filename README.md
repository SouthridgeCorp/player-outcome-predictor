# player-outcome-predictor
Predictive modeling to forecast player outcomes over a T20 tournament

## Getting the data ready
Before running the app, input data must be prepared: 
- Run `scripts/helpers/parse_cricsheet_inputs.py`
- The `parse_cricsheet_inputs.py` script parses T20 match information from cricsheet and generates the datasets to be 
used by the predictor app  This script converts `scripts/helpers/resources/IPLMatches.csv` to a format which is acceptable by the app
- The output of the script is a csv list of the matches we know about and a list of tournaments we know about
- For detailed instructions on how to run the script and its expected inputs & outputs, please refer to 
`scripts/helpers/README_parse_cricsheet_inputs.md`

### Setting up configuration for a deployment
#### Config.toml
* The app expects all config variables to be present in `./.streamlit/config.toml`.  
* If saving feedback in local files, copy `config.local.toml` to `./.streamlit/config.toml` 
before further customisations
* If saving feedback in snowflake, copy `config.snowflake.toml` to `./.streamlit/config.toml` before further customisations.
(Snowflake will require additional credentials for logging in - see Secrets section below)
* If saving feedback in Google drive, copy `config.google.toml` to `./.streamlit/config.toml` before further 
customisation. Please also setup your secrets for Google as defined below.

#### Secrets.toml
IMPORTANT: Credentials in Secrets must never be checked in and always maintained as local edits

##### For Local Feedback
Please touch `.streamlit/secrets.toml` (but can leave it blank)

##### For Google

You can directly read from the [link](https://docs.streamlit.io/knowledge-base/tutorials/databases/private-gsheet) or read below:
- Create a google cloud account to access google sheets programmatically.
- Select or create a project if asked.
- Head over APIs & Services dashboard. Search Google Sheets API and enable it.
- Go to the Service Accounts page and create an account with the Viewer permission.
- First, note down the email address of the account you just created (important for next step!)
- Then, create a JSON key file for the new account and download it. We will need this json file to populate the contents of the secrets.toml file.
- Create .streamlit/secrets.toml in your app's root directory.
Content of the file should be like below. You should fill the following contents with the information contained in the json file.

```
# .streamlit/secrets.toml

private_gsheets_url = "https://docs.google.com/spreadsheets/d/12345/edit?usp=sharing"

[gcp_service_account]
type = "service_account"
project_id = "xxx"
private_key_id = "xxx"
private_key = "xxx"
client_email = "xxx"
client_id = "xxx"
auth_uri = "https://accounts.google.com/o/oauth2/auth"
token_uri = "https://oauth2.googleapis.com/token"
auth_provider_x509_cert_url = "https://www.googleapis.com/oauth2/v1/certs"
client_x509_cert_url = "xxx"
```

##### For Snowflake
Contact Gireesh to configure Snowflake access


### Run the streamlit application locally
`streamlit run app.py`

### Host the streamlit application externally
* Follow the instruction on https://share.streamlit.io/deploy
* Currently only deployments from main seem to work
* Contact gireesh if you are unable to get access

### Retrieve and investigate available feedback

* Depends on the storage method. Check test/test_utils/test_config_utils.py to understand how feedback files are stored
depending on the configured storage method
* Two storage methods are currently supported: Local and Snowflake
* Contact gireesh if you need access to snowflake

### Repo Structure
```
project
â”‚   README.md [technical readme for this repo]
â”‚   working_backwards.md [working backwards questions for the product]
â”‚   press_release.md [press release for the product]
â”‚   faq.md [faq for the product]
â”‚   requirements.txt [python library dependecies for this repo]
â”‚   app.py [streamlit app for this repo]
â”‚   
â””â”€â”€â”€.FDm [sample toml files which can be used to configure the app]   
â”‚   
â””â”€â”€â”€data [ignored by git, repo for data generated by the app]   
â”‚   
â””â”€â”€â”€resources [version controlled data folder]
â”‚   â””â”€â”€â”€test [folder to locate data for test cases]
â”‚   â””â”€â”€â”€working_backwards [folder with content to be served for working backwards]
â”‚   â””â”€â”€â”€press_release [folder with content to be served for press_relase]
â”‚   â””â”€â”€â”€faq [folder with content to be served for faq]
â”‚   â””â”€â”€â”€computational_model [folder with content to be served for computational model]
â”‚   â””â”€â”€â”€architecture_hypothesis [folder with content to be served for architecture_hypothesis] 
â”‚   
â””â”€â”€â”€pages [python module for hosting all pages of the streamlit application]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   2_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   1_ðŸ“‹_About.py [serves resources/press_release]
    â”‚   2_ðŸ“‹_FAQ.py [serves resources/faq and resources/working_backwards]
    â”‚   3_ðŸ“‹_Architecture_Hypothesis.py [serves resources/architecture_hypothesis]
    â”‚   4_ðŸ“‹_Computational_Model.py [serves resources/computational_model]
    â”‚   5_ðŸ“‹_Feedback.py [serves page to collect feedback]
â”‚   
â””â”€â”€â”€utils [python module for serving configuration from schemas]
    â”‚   graph_utils.py [utility functions for rendering mermaid graphs]
    â”‚   page_utils.py [utility functions for rendering streamlit tab pages]
    â”‚   config_utils.py [business logic for the module]
â”‚   
â””â”€â”€â”€test [python module with all test cases]
```

## Running Tests
`pytest test`

